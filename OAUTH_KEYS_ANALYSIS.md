# OAuth Keys Analysis for Samsung FOTA

## Native Library Analysis

### Library: libdprw.so
Located in: `FotaAgent/lib/arm64-v8a/libdprw.so`

### Native Methods Found
```java
// From smali analysis:
NativeUtils.getKey()         -> Returns AES encryption key for EXML files
NativeUtils.getRegiKey()     -> Returns OAuth consumer key for registration
NativeUtils.getRegiValue()   -> Returns OAuth consumer secret for registration  
NativeUtils.getTimeKey()     -> Returns OAuth consumer key for time-based auth
NativeUtils.getTimeValue()   -> Returns OAuth consumer secret for time-based auth
```

### Keys Extracted from libdprw.so

#### Hex Keys (32 characters):
- `5763D0052DC1462E13751F753384E9A9`
- `AF87056C54E8BFD81142D235F4F8E552`

#### AES Key for EXML Decryption:
- Key: `syncml7790010123` (16 bytes)
- Generated by Mealy Machine algorithm with parameters (0x172c, 0x10)
- Source: decrypt_profiles.py script

#### Other Strings:
- `dkaghghkehlsvkdlsmld` (20 chars) - Possible obfuscated key
- `j5p7ll8g33` (10 chars)
- `2cbmvps5z4` (10 chars)

## OAuth Implementation

### From RequestPropertiesForOsp$WithAuth.smali:

The FOTA agent uses OAuth 1.0 with HmacSHA1 signature:

```java
oauth_consumer_key      -> From getRegiKey() or getTimeKey()
oauth_consumer_secret   -> From getRegiValue() or getTimeValue()
oauth_signature_method  -> "HmacSHA1"
oauth_version           -> "1.0"
oauth_nonce             -> Random 10-char hex string
oauth_timestamp         -> Current Unix time (seconds)
```

### Authentication Flow:

1. **ByCurrentTime** - Uses system time
   - Gets timeKey and timeValue from native
   - Uses current timestamp

2. **ByServerTime** - Uses server-provided time
   - Gets timeKey and timeValue from native
   - Uses server timestamp from previous response

## Current SamFirm Implementation

### FUSClient.cs:
Uses FUS (Firmware Update Service) authentication:
```csharp
Authorization: FUS nonce="{nonce}", signature="{signature}", nc="", type="", realm="", newauth="1"
```

This is DIFFERENT from the OAuth implementation in FOTA agent!

## Key Findings:

1. **FOTA Agent uses OAuth 1.0** for OSP (Open Service Platform) requests
2. **SamFirm uses FUS authentication** for neofussvr requests
3. **Keys are hardcoded in native library** and obfuscated
4. **Test server may require different authentication** than production

## Recommendations:

1. The 408 error suggests authentication/authorization issue
2. Need to determine if test server requires:
   - OAuth authentication (like FOTA agent)
   - FUS authentication (like current SamFirm)
   - Different credentials for test vs production

3. The headers we added (X-Sec-Dm-DeviceModel, etc.) are correct
4. The CLIENT_VERSION update to 4.4.14 is correct

## Next Steps:

1. Try implementing OAuth 1.0 authentication for test server requests
2. Use the native keys if we can extract them properly
3. Or determine if the IMEI truly isn't authorized for test firmware
